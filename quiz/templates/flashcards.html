{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  body {
    background-color: #f0f2f5;
  }

  .flip-card {
    perspective: 1000px;
    max-width: 500px;
    margin: auto;
  }

  .flip-card-inner {
    position: relative;
    width: 100%;
    transition: transform 0.6s;
    transform-style: preserve-3d;
  }

  .flip-card-front, .flip-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 20px;
  }

  .flip-card-front {
    background-color: #ffffff;
    color: #1a1a1a;
  }

  .flip-card-back {
    background-color: #0078D4;
    color: #ffffff;
    transform: rotateY(180deg);
  }

  .flip-card-inner.flipped {
    transform: rotateY(180deg);
  }

  .btn-primary {
    background-color: #0078D4;
    border: none;
  }

  .btn-primary:hover {
    background-color: #005fa3;
  }

  .btn-favorite.active {
    background-color: gold;
    color: black;
  }

  .progress {
    height: 20px;
  }

  .progress-bar {
  transition: width 0.4s ease;
}


  @keyframes pulse {
    0% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); opacity: 0.8; }
  }

  /* .flashcard-animate-in {
    animation: fadeIn 0.4s ease-in;
  }

  .flashcard-animate-out {
    animation: fadeOut 0.4s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes fadeOut {
    from { opacity: 1; transform: scale(1); }
    to { opacity: 0; transform: scale(0.95); } 
   
  } */

  @keyframes slideOutLeft {
  0% { transform: translateX(0); opacity: 1; }
  100% { transform: translateX(-100%); opacity: 0; }
}

@keyframes slideInRight {
  0% { transform: translateX(100%); opacity: 0; }
  100% { transform: translateX(0); opacity: 1; }
}

.flashcard-slide-out {
  animation: slideOutLeft 0.4s ease-out forwards;
}

.flashcard-slide-in {
  animation: slideInRight 0.4s ease-in forwards;
}

</style>

<div class="container-lg py-4 text-center">
  <div class="row justify-content-center mb-4">
    <div class="col">
      <h2 class="mb-3">Flashcards: Life in the UK</h2>
      <div class="flip-card" id="flashcard">
        <div class="flip-card-inner" id="flip-btn">
          <!-- Front -->
          <div class="flip-card-front">
            <h5 class="card-title">Question</h5>
            <div class="card-text" id="question">Loading...</div>
          </div>
          <!-- Back -->
          <div class="flip-card-back">
            <h5 class="card-title">Answer</h5>
            <div class="card-text" id="answer">Loading...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row justify-content-center mt-3">
    <div class="col-md-6">
      <div class="d-grid gap-3">
        <!-- <button class="btn btn-outline-secondary" id="flip-button" type="button">üëÅÔ∏è Show Answer</button> -->
        <button class="btn btn-success" id="next-btn" type="button">‚û°Ô∏è Next</button>
        <!-- <button class="btn btn-warning btn-favorite" id="favorite-btn" type="button">‚≠ê Favorite</button> -->
      </div>
    </div>
  </div>

  <div class="row justify-content-center mt-4">
    <div class="col-md-6">
      <div class="progress">
        <div class="progress-bar bg-info" role="progressbar" style="width: 0%;" id="progress-bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
      </div>
    </div>
  </div>
</div>

{{ questions_json|json_script:"flashcards-data" }}
<script>
  window.onload = function () {
    const flashcards = JSON.parse(document.getElementById('flashcards-data').textContent);
    const totalFlashcards = flashcards.length - 1; // remove o √∫ltimo item (mensagem)
    const questionEl = document.getElementById('question');
    const answerEl = document.getElementById('answer');
    const flipBtn = document.getElementById('flip-btn');
    // const flipButton = document.getElementById('flip-button');
    const nextBtn = document.getElementById('next-btn');
    // const favoriteBtn = document.getElementById('favorite-btn');
    const progressBar = document.getElementById('progress-bar');
    const card = document.getElementById('flashcard');
    

    let current = -1;
    let vistos = new Set();
    let started = false;
    let favorites = new Set();

    // flipButton.disabled = true;
    nextBtn.disabled = true;
    // favoriteBtn.disabled = true;

    function showStartCard() {
      questionEl.innerHTML = '<span style="font-size:1.4rem; font-weight:bold; color:#0078D4; animation:pulse 1.5s infinite; cursor:pointer;">üëÜ Tap here to start</span>';
      answerEl.textContent = '...';
      card.classList.remove('flipped');
      progressBar.style.width = '0%';
      progressBar.textContent = '0%';
      progressBar.setAttribute('aria-valuenow', 0);
    }

    function showFlashcard(idx) {
      questionEl.textContent = flashcards[idx].question;
      answerEl.textContent = flashcards[idx].answer;
      card.classList.remove('flipped');
      updateProgress(idx);
    //   updateFavoriteButton(idx);
    }

    function updateProgress() {
    const percent = Math.round((vistos.size / totalFlashcards) * 100);
    progressBar.style.width = percent + '%';
    progressBar.textContent = `${vistos.size}/${totalFlashcards}`;
    progressBar.setAttribute('aria-valuenow', percent);
    }



    // function updateFavoriteButton(idx) {
    //   if (favorites.has(idx)) {
    //     favoriteBtn.classList.add('active');
    //     favoriteBtn.textContent = '‚≠ê Favorito';
    //   } else {
    //     favoriteBtn.classList.remove('active');
    //     favoriteBtn.textContent = '‚≠ê Favoritar';
    //   }
    // }

function startFlashcards() {
  if (!started) {
    started = true;
    current = 0;
    // flipButton.disabled = false;
    nextBtn.disabled = false;
    // favoriteBtn.disabled = false;
    showFlashcard(current);
    updateProgress(); // ‚Üê ensure progress starts at 1
  }
}



function nextFlashcard() {
  current++;

  if (current < flashcards.length) {
    vistos.add(current);
    flipBtn.classList.remove('flipped');
    flipBtn.classList.add('flashcard-slide-out');

    setTimeout(function () {
      showFlashcard(current);
      updateProgress();
      flipBtn.classList.remove('flashcard-slide-out');
      flipBtn.classList.add('flashcard-slide-in');
      setTimeout(() => flipBtn.classList.remove('flashcard-slide-in'), 400);
    }, 400);
} else {
  // Hide flashcard and show completion message
  document.getElementById('flashcard').style.display = 'none';

  const container = document.querySelector('.container-lg');
  const endMessage = document.createElement('div');
  endMessage.className = 'mt-5';
  endMessage.innerHTML = `
    <h3 style="color:#0078D4;">üéâ You‚Äôve completed all flashcards!</h3>
    <p>Click the button below to restart the session.</p>
    <button class="btn btn-primary mt-3" id="restart-btn">üîÑ Restart</button>
  `;
  container.appendChild(endMessage);

  nextBtn.style.display = 'none';
//   flipButton.style.display = 'none';
//   favoriteBtn.style.display = 'none';

  document.getElementById('restart-btn').onclick = restartSession;
}
}







    flipBtn.onclick = function () {
      if (!started) {
        startFlashcards();
      } else {
        card.classList.toggle('flipped');
      }
    };

    // flipButton.onclick = function () {
    //   if (started) {
    //     card.classList.toggle('flipped');
    //   }
    // };

    nextBtn.onclick = function () {
      if (started) {
        nextFlashcard();
      }
    };

    // favoriteBtn.onclick = function () {
    //   if (started) {
    //     if (favorites.has(current)) {
    //       favorites.delete(current);
    //     } else {
    //       favorites.add(current);
    //     }
    //     // updateFavoriteButton(current);
    //   }
    // };

    function restartSession() {
  current = -1;
  started = false;
  vistos.clear();
  updateProgress();

  // Restore flashcard
  document.getElementById('flashcard').style.display = 'block';

  // Remove end message
  const endMsg = document.querySelector('.container-lg .mt-5');
  if (endMsg) endMsg.remove();

//   flipButton.style.display = 'inline-block';
  nextBtn.style.display = 'inline-block';
//   favoriteBtn.style.display = 'inline-block';

//   flipButton.disabled = true;
  nextBtn.disabled = true;
//   favoriteBtn.disabled = true;
  nextBtn.textContent = '‚û°Ô∏è Next';
  nextBtn.onclick = function () {
    if (started) {
      nextFlashcard();
    }
  };

  showStartCard();
}



    showStartCard();
  };
</script>
{% endblock %}